Stickymate это инструмент, который поможет веб-разработчикам создавать анимации без знания JavaScript, позволяя задавать параметры анимации прямо в HTML разметке. Stickymate объединяет функции расширенного липкого позиционирования и анимации, основанной на прокрутке, что позволяет поймать элемент на экране и анимировать его, пока пользователь прокручивает страницу. Также есть возможность добавлять и удалять классы, чтобы управлять анимацией из CSS. Используйте ваше воображения для воплощения отличных идей, которые презентуют ваш контент наиболее эффектным образом.

## Демо

[Демонстрация Stickymate](https://rafailyk.github.io/stickymate/)

## Установка

- [Загрузите](https://github.com/rafailyk/stickymate/archive/master.zip) и распакуйте, или просто
```
$ npm install stickymate
```
- Подключите `stickymate.js` в тег `head` или в конец тега `body`.

## Использование

- Добавьте атрибуты `data-sticky`, `data-animation` или `data-classes` в ваш элемент, вместе или раздельно.
``` html
<div data-sticky="..." data-animation="..." data-classes="..."></div>
```
- Задайте параметры для атрибутов.
``` html
<div data-sticky="from: 0, duration: 100vh" data-animation="opacity: {0: 1, 100vh: 0}" data-classes="0vh: {add: class1}"></div>
```
- Задайте параметры по следующей схеме.
``` html
<div
    data-sticky="
        from: позиция,           // позиция от верха вьюпорта, на которой элемент залипнет на экране
        duration: позиция        // позиция, на которой элемент перестанет быть липким (фактически, расширяя min-height родительского контейнера, тем самым резервируя место для прокрутки)
    "
    data-animation="
        CSS свойство: {
            позиция: значение,   // начальный параметр анимации
            позиция: значение,   // опционально, промежуточные параметры
            позиция: значение    // финальный параметр анимации
        },
        CSS свойство: {...}      // опционально, дополнительные CSS свойства
    "
    data-classes="
        позиция: {               // позиция от верха вьюпорта
            add: класс класс,    // имена классов (один или несколько через пробел), которые будут добавлены
            remove: класс класс  // имена классов (один или несколько через пробел), которые будут удалены
        },
        позиция: {...}.          // опционально
    "
></div>
```
- Атрибут `data-sticky` может содержать только два параметра с названиями `from` и `duration`.
- Если нет необходимости расширять min-height родительского контейнера, можно указать `0` для значения `duration`.
- Атрибут `data-classes` может содержать `add` и `remove` ключи по отдельности или вместе.
- Ключи `add` и `remove` атрибута `data-classes` могут содержать одно имя класса или несколько, разделенных пробелом.
- Атрибут `data-animation` может содержать одно или несколько CSS свойств, разделенных запятыми.
- Каждое CSS свойство `data-animation` может содержать два или более позиционных ключа, разделенных запятыми.
- Задавайте названия CSS свойств анимации без указания вендорных префиксов (префикс `-webkit-` добавляется автоматически).
- Позиционные ключи должны указываться в `px` (пиксели), `vh` (высота вьюпорта) или `vw` (ширина вьюпорта).
- Вы можете указать позицию `from` для атрибута `data-sticky` как `top / center / bottom`.
``` html
<div data-sticky="from: center, duration: 100vh"></div>
```
- Значения для CSS свойств и значений `data-animation` указываются так же, как в CSS.
- Позиция `0` может указываться без единиц измерения.
- Позиция `-100vh` = верх элемента достиг низа вьюпорта.
- Позиция `0vh` или `0px` или просто `0` = верх элемента достиг верха вьюпорта.
- Позиция `100vh` = верх элемента достиг верха вьюпорта + одна высота вьюпорта была прокручена после этого.

## Примеры

- Все три атрибута одновременно. В этом примере элемент залипает на экране, а его прозрачность меняется от `1` до `0`, пока пользователь прокручивает страницу на одну высоту вьюпорта. После этого к элементу будет добавлен класс `class1`.
``` html
<div data-sticky="from: 0, duration: 100vh" data-animation="opacity: {0: 1, 100vh: 0}" data-classes="100vh: {add: class1}"></div>
```

- Липкий элемент. Когда верх элемента достигнет верха вьюпорта (`from: 0`), элемент прилипнет к экрану, пока вы не прокрутите вверх две высоты вьюпорта (`duration: 200vh`) с момента залипания.
``` html
<div data-sticky="from: 0, duration: 200vh"></div>
```

- Анимируемый элемент с одним CSS свойством и двумя позиционными ключами. Пока верх элемента перемещается от низа вьюпорта `-100vh` к центру `-50vh`, его прозрачность изменяется от `0` к `1`. Аналогично `opacity: 0;` и `opacity: 1;` в CSS. Визуально, это эффект появления.
``` html
<div data-animation="opacity: {-100vh: 0, -50vh: 1}"></div>
```

- Анимация с одним CSS свойством и множественными позиционными ключами. В этом примере прозрачность элемента меняется в два этапа, от `0` к `1` (пока верх элемента перемещается вдоль нижней четверти вьюпорта: `-100vh`, `-75vh`) и от `1` к `0.25` (пока верх элемента перемещается вдоль верхней четверти вьюпорта: `-25vh`, `0vh`).
``` html
<div data-animation="opacity: {-100vh: 0, -75vh: 1, -25vh: 1, 0vh: .25}"></div>
```

- Анимация CSS свойства `transform` с несколькими значениями одновременно.
``` html
<div data-animation="transform: {-100vh: scale(1) translate(0, 0) rotate(0), -50vh: scale(.5) translate(50%, 0) rotate(22.5deg)}"></div>
```

- Анимация с несколькими CSS свойствами. Каждое CSS свойство имеет свои собственные позиционные ключи и значения.
``` html
<div data-animation="opacity: {-100vh: 0, -75vh: 1}, transform: {-100vh: scale(.75), -50vh: scale(1)}"></div>
```

- Добавление и удаление классов. Примеры можно увидеть в правой колонке [Demo](https://rafaylik.github.io/stickymate/), где классами подсвечиваются активные ключи.
``` html
<div data-classes="25vh: {add: class1}, 50vh: {add: class2 class3, remove: class1}, 75vh: {remove: class2 class3}"></div>
```

## CSS свойства анимации

- Вы можете анимировать любые CSS свойства, значения которых содержат только цифры или числа в `%`, `px`, `vw`, `vh`, `em`, `rem`, `deg`.
- Вы не можете анимировать CSS свойство `color` и свойства, значение которых содержат: `left`, `right`, `top`, `bottom`, `center`, `none`, `auto`, `transparent` и т.д.
- Проверенные CSS свойства:
    - `transform: matrix() scale() translate() rotate() translate3D() rotate3D()`
    - `opacity: 0-1`
    - `background-size: ...`
    - `background-position: ...`
    - `border: ...`
    - `font-size: ...`

## Совместимость с браузером

Все современные браузеры, которые поддерживают ECMAScript 6

- Chrome: 56
- Edge: 16
- Firefox: 48
- Internet Explorer: Нет
- Opera: 43
- Safari: 10
- Chrome on Android: 56
- Firefox on Android: 59
- Safari on iOS: 10

## История версий

- 1.2.5
    - Указание параметров упрощено. Старый синтаксис: `data-sticky='{"from": "0vh", "duration": "100vh"}'`. Новый синтаксис: `data-sticky="from: 0vh, duration: 100vh"`.
    - Новый атрибут `data-classes`. Теперь можно добавлять/удалять элементу одно или несколько имен CSS классов на указанных позиционных ключах.
    - Свойство transform с несколькими значениями, как `scale(...)`, `translate(...)` и т.д., теперь автоматически упорядочиваются в одинаковый порядок для каждого ключа.
    - Релиз на npm.
- 1.3.0
    - Отслеживание элементов с помощью `IntersectionObserver` вместо постоянного прослушивания события `scroll`.
- 1.3.3
    - Исправлено определение position родительского элемента.
- 1.3.6
    - Ключи теперь автоматически сортируются в порядке следования, что исключает ошибки анимации, если ключи указаны в случайном порядке.

## Известные незначительные проблемы

- Липкий элемент и родители со свойством overflow. Любой родитель `data-sticky` элемента не должен иметь свойство `overflow`, значение которого отличается visible (по умолчанию). Читайте больше о проблеме: [Support position:sticky inside an overflow:hidden|auto on general parents](https://github.com/w3c/csswg-drafts/issues/865). Если ваша анимация переполняет элемент (любая трансформация, которая увеличивает элемент и создает горизонтальную полосу прокрутки) и вам необходимо использовать `overflow: hidden`, просто следуйте следующей схеме:
    - Не работает: `элемент с overflow: hidden` \> `липкий и анимируемый элемент`.
    - Работает: `липкий элемент с overflow: hidden` \> `анимируемый элемент`.
- Вращение и матричная трансформация. Не пытайтесь вращать элемент с помощью `transform: matrix()`, так как скрипт не высчитывает `sin` и `cos` для корректного преобразования. Для вращения используйте `transform: rotate()`.
- Прокрутка в Edge (только EdgeHTML). Периодические ошибки в позиционировании анимируемых элементов внутри родителя с `overflow: hidden`, при прокрутке в обратном направлении.

## Автор и лицензия

**Michael Rafailyk** - [rafaylik](https://github.com/rafailyk) на GitHub. Проект разрабатывается под MIT License - детали смотрите в [LICENSE.md](./LICENSE).